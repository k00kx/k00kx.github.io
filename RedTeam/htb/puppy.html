<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Puppy</title>

  <!-- Metadados para gerar o card automaticamente (common-listing.js) -->
  <meta name="portfolio-title" content="Puppy">
  <meta name="portfolio-description"
    content="Full Active-Directory compromise, DPAPI abuse and privilege escalation on Windows Server 2022.">
  <meta name="portfolio-tags" content="windows, active-directory, privilege-escalation, bloodhound, dpapi">
  <meta name="portfolio-thumb" content="/img/redteam/htb/puppy/puppy-logo.png">
  <meta name="portfolio-source" content="HackTheBox">

  <!-- Fonte e CSS principal -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Fira+Code&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/css/style.css" />

  <!-- Script do menu/particles (permanece inalterado) -->
  <script src="/js/script.js" defer></script>

  <!-- Biblioteca markdown-it via CDN -->
  <script src="https://cdn.jsdelivr.net/npm/markdown-it/dist/markdown-it.min.js" defer></script>

  <!--
    Este script interno substitui o antigo puppy-content.js.
    Ele:
      1) L√™ as metas do <head> (descri√ß√£o + tags) e injeta em #redteam-summary
      2) Faz fetch de puppy.md, converte para HTML e injeta em #markdown-content
      3) Destaca em amarelo as linhas que come√ßam com "~$" dentro de <pre><code>
  -->
  <script defer>
    document.addEventListener('DOMContentLoaded', async () => {
      // 1) Fun√ß√£o utilit√°ria para ler <meta name="‚Ä¶">
      const getMeta = name => {
        const el = document.querySelector(`meta[name="${name}"]`);
        return el ? el.content.trim() : '';
      };

      // 2) Injeta resumo (descri√ß√£o + tags) em #redteam-summary
      const description = getMeta('portfolio-description');
      const tags = getMeta('portfolio-tags')
        .split(',')
        .map(t => t.trim())
        .filter(Boolean);

      const summaryContainer = document.getElementById('redteam-summary');
      summaryContainer.innerHTML = `
      <p style="font-size:1rem; color:#bbb; margin-bottom:18px; text-align:center">
        ${description}
        </p>
        <div class="tag-list" style="justify-content:center">
          ${tags.map(t => `<span class="tag">${t}</span>`).join('')}
          </div>
`;

      // 3) Faz fetch do puppy.md (mesma pasta que puppy.html)
      try {
        const resp = await fetch('puppy.md', { cache: 'no-cache' });
        if (!resp.ok) throw new Error('HTTP ' + resp.status);
        const mdText = await resp.text();

        // 4) Inicializa markdown-it e converte
        const md = window.markdownit({
          html: true,        // permite HTML embutido, se houver
          linkify: true,     // converte URLs autom√°ticos em links
          typographer: true  // ativar substitui√ß√µes tipogr√°ficas
        });
        const renderedHTML = md.render(mdText);

        // 5) Injeta o HTML convertido em #markdown-content
        document.getElementById('markdown-content').innerHTML = renderedHTML;

        // 6) Destaca em amarelo as linhas que come√ßam com "~$" dentro de cada <pre><code>
        document.querySelectorAll('.markdown-body pre code').forEach(block => {
          block.innerHTML = block.innerHTML
            .split('\n')
            .map(line =>
              line.trimStart().startsWith('~$')
                ? `<span style="color:#FFD700;font-weight:bold;">${line}</span>`
                : line
            )
            .join('\n');
        });
      }
      catch (err) {
        console.error('Erro ao carregar Markdown:', err);
        document.getElementById('markdown-content').innerHTML = `
          <p style="color:red; text-align:center">
            Falha ao carregar conte√∫do Markdown.<br>
            (${err.message})
          </p>
        `;
      }
    });
  </script>
</head>

<body class="home">
  <div id="tsparticles"></div>
  <header id="header-container"></header>

  <div class="machine-banner">
    <img src="/img/redteam/htb/puppy/puppy-logo.png" alt="Puppy HTB Logo">
  </div>

  <section style="text-align:center;margin-top:20px">
    <p><strong>Difficulty:</strong> Medium</p>
    <p><strong>OS:</strong> Windows</p>
    <p>
      <a href="https://www.hackthebox.com/machines/puppy" target="_blank" class="htb-link">üîó Link to HTB</a>
    </p>
  </section>

  <!-- Onde o resumo (descri√ß√£o + tags) ser√° injetado dinamicamente -->
  <section id="redteam-summary" class="markdown-container" style="margin-top:25px">
  </section>

  <main class="markdown-container">
    <!-- Aqui entra o HTML convertido do puppy.md -->
    <article id="markdown-content" class="markdown-body"></article>
  </main>
</body>

</html>